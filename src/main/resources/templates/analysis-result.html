<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, ~{::section})}">
<head>
    <title th:text="'Analysis of #' + ${analysis.hashtag} + ' - HashLife Analytics'">Analysis Result</title>
</head>
<body>
<section>
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8" data-aos="fade-right" data-aos-duration="1000">
                    <h1 class="display-4 fw-bold">
                        Analysis of <span class="text-light" th:text="'#' + ${analysis.hashtag}">hashtag</span>
                    </h1>
                    <p class="lead">
                        <i class="bi bi-calendar3"></i>
                        <span th:text="${#temporals.format(analysis.startDate, 'dd MMM yyyy')}">01 Jun 2025</span>
                        to
                        <span th:text="${#temporals.format(analysis.endDate, 'dd MMM yyyy')}">10 Jun 2025</span>
                    </p>
                </div>
                <div class="col-lg-4 text-lg-end mt-3 mt-lg-0" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="200">
                    <a href="/analysis" class="btn btn-light">
                        <i class="bi bi-plus-circle"></i> New Analysis
                    </a>
                    <a href="#" class="btn btn-outline-light ms-2" onclick="window.print()">
                        <i class="bi bi-download"></i> Export
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <!-- Key Metrics Dashboard -->
        <div class="row g-4 mb-5">
            <div class="col-md-3" data-aos="fade-up" data-aos-duration="800">
                <div class="card border-0 shadow-sm h-100 tilt-card">
                    <div class="card-body text-center p-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle p-3 mb-3">
                            <i class="bi bi-chat-left-text text-primary fs-4"></i>
                        </div>
                        <h5 class="text-uppercase fw-bold text-muted small">Total Tweets</h5>
                        <h2 class="display-5 fw-bold mb-0 counter" th:data-target="${analysis.totalTweets}" th:text="${analysis.totalTweets}">1000</h2>
                        <div class="mt-2">
                            <span class="badge bg-success">
                                <i class="bi bi-arrow-up"></i> Analyzed
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
                <div class="card border-0 shadow-sm h-100 tilt-card">
                    <div class="card-body text-center p-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle p-3 mb-3">
                            <i class="bi bi-repeat text-primary fs-4"></i>
                        </div>
                        <h5 class="text-uppercase fw-bold text-muted small">Total Retweets</h5>
                        <h2 class="display-5 fw-bold mb-0 counter" th:data-target="${analysis.totalRetweets}" th:text="${analysis.totalRetweets}">500</h2>
                        <div class="mt-2">
                            <span class="badge bg-primary">
                                <i class="bi bi-share"></i> Reach
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400">
                <div class="card border-0 shadow-sm h-100 tilt-card">
                    <div class="card-body text-center p-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle p-3 mb-3">
                            <i class="bi bi-heart text-primary fs-4"></i>
                        </div>
                        <h5 class="text-uppercase fw-bold text-muted small">Total Likes</h5>
                        <h2 class="display-5 fw-bold mb-0 counter" th:data-target="${analysis.totalLikes}" th:text="${analysis.totalLikes}">2500</h2>
                        <div class="mt-2">
                            <span class="badge bg-danger">
                                <i class="bi bi-heart-fill"></i> Engagement
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3" data-aos="fade-up" data-aos-duration="800" data-aos-delay="600">
                <div class="card border-0 shadow-sm h-100 tilt-card">
                    <div class="card-body text-center p-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle p-3 mb-3">
                            <i class="bi bi-bar-chart text-primary fs-4"></i>
                        </div>
                        <h5 class="text-uppercase fw-bold text-muted small">Engagement Rate</h5>
                        <h2 class="display-5 fw-bold mb-0 counter"
                            th:data-target="${analysis.totalTweets > 0 ? (analysis.totalRetweets + analysis.totalLikes) / analysis.totalTweets : 0}"
                            th:text="${analysis.totalTweets > 0 ? #numbers.formatDecimal((analysis.totalRetweets + analysis.totalLikes) / analysis.totalTweets, 1, 2) : 0}">3.0</h2>
                        <div class="mt-2">
                            <span class="badge bg-info">
                                <i class="bi bi-graph-up"></i> Impact
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row mb-5" data-aos="fade-up" data-aos-duration="1000">
            <div class="col-12">
                <div class="card shadow mb-4 border-0">
                    <div class="card-header bg-white py-3 d-flex align-items-center justify-content-between">
                        <h3 class="h5 mb-0 fw-bold">Hashtag Lifecycle</h3>
                        <div class="chart-actions">
                            <div class="btn-group" role="group" aria-label="Chart view options">
                                <button type="button" class="btn btn-sm btn-outline-primary active" id="viewWeekly">Weekly</button>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="viewDaily">Daily</button>
                            </div>
                            <button class="btn btn-sm btn-outline-primary ms-2" id="downloadChart">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <canvas id="lifecycleChart" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Related Hashtags -->
            <div class="col-md-6" data-aos="fade-right" data-aos-duration="1000">
                <div class="card shadow h-100 border-0">
                    <div class="card-header bg-white py-3">
                        <h3 class="h5 mb-0 fw-bold">Related Hashtags</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush rounded-bottom">
                            <div class="list-group-item d-flex justify-content-between align-items-center px-4 py-3 border-start-0 border-end-0"
                                th:each="hashtag, iter : ${analysis.relatedHashtags}"
                                th:style="${'--animation-order: ' + iter.count}">
                                <div class="d-flex align-items-center">
                                    <div class="me-3" style="width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; background: rgba(67, 97, 238, 0.1); border-radius: 50%;">
                                        <i class="bi bi-hash text-primary small"></i>
                                    </div>
                                    <span th:text="${hashtag}">hashtag</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="progress me-2" style="width: 60px; height: 6px;" th:data-value="${iter.count}">
                                        <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">
                                        <!-- Would show count here if available -->
                                    </span>
                                </div>
                            </div>
                            <div class="list-group-item text-center text-muted py-4" th:if="${#lists.isEmpty(analysis.relatedHashtags)}">
                                <i class="bi bi-emoji-neutral mb-2 display-6 text-muted"></i>
                                <p>No related hashtags found</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Influencers -->
            <div class="col-md-6" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="200">
                <div class="card shadow h-100 border-0">
                    <div class="card-header bg-white py-3">
                        <h3 class="h5 mb-0 fw-bold">Top Influencers</h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush rounded-bottom">
                            <div class="list-group-item d-flex justify-content-between align-items-center px-4 py-3 border-start-0 border-end-0"
                                th:each="influencer, iter : ${analysis.topInfluencers}"
                                th:style="${'--animation-order: ' + iter.count}">
                                <div class="d-flex align-items-center">
                                    <div class="me-3 rounded-circle bg-light d-flex align-items-center justify-content-center"
                                        style="width: 36px; height: 36px;">
                                        <i class="bi bi-person text-primary"></i>
                                    </div>
                                    <span th:text="${influencer}">@username</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="progress me-2" style="width: 60px; height: 6px;" th:data-value="${iter.index + 1}">
                                        <div class="progress-bar bg-info progress-bar-striped" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">
                                        <!-- Would show count here if available -->
                                    </span>
                                </div>
                            </div>
                            <div class="list-group-item text-center text-muted py-4" th:if="${#lists.isEmpty(analysis.topInfluencers)}">
                                <i class="bi bi-emoji-neutral mb-2 display-6 text-muted"></i>
                                <p>No top influencers found</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Tweets -->
        <div class="row mt-5" data-aos="fade-up" data-aos-duration="1000" data-aos-delay="400">
            <div class="col-12">
                <div class="card shadow border-0">
                    <div class="card-header bg-white py-3 d-flex align-items-center justify-content-between">
                        <h3 class="h5 mb-0 fw-bold">Sample Tweets</h3>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" id="tweetSortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                Sort by
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="tweetSortDropdown">
                                <li><a class="dropdown-item" href="#">Date (newest first)</a></li>
                                <li><a class="dropdown-item" href="#">Most likes</a></li>
                                <li><a class="dropdown-item" href="#">Most retweets</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="tweet-list">
                            <div class="tweet-card mb-3" th:each="tweet, iter : ${analysis.sampleTweets}"
                                th:data-aos="fade-up" th:data-aos-duration="800" th:data-aos-delay="${iter.count * 100}">
                                <div class="d-flex">
                                    <div class="tweet-avatar me-3">
                                        <div class="avatar-placeholder bg-light rounded-circle d-flex align-items-center justify-content-center"
                                            style="width: 50px; height: 50px; color: #777;">
                                            <i class="bi bi-person"></i>
                                        </div>
                                    </div>
                                    <div class="tweet-content flex-grow-1">
                                        <div class="tweet-header d-flex">
                                            <h6 class="mb-0 fw-bold" th:text="${tweet.username}">Username</h6>
                                            <small class="text-muted ms-auto"
                                                   th:text="${#temporals.format(tweet.createdAt, 'dd MMM yyyy HH:mm')}">Date</small>
                                        </div>
                                        <div class="tweet-text my-2" th:text="${tweet.text}">Tweet text</div>
                                        <div class="tweet-stats d-flex text-muted small">
                                            <div class="me-3 d-flex align-items-center">
                                                <i class="bi bi-heart me-1"></i> <span th:text="${tweet.likeCount}">0</span>
                                            </div>
                                            <div class="me-3 d-flex align-items-center">
                                                <i class="bi bi-repeat me-1"></i> <span th:text="${tweet.retweetCount}">0</span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-chat me-1"></i> <span th:text="${tweet.replyCount}">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center text-muted py-5" th:if="${#lists.isEmpty(analysis.sampleTweets)}">
                                <i class="bi bi-emoji-neutral display-4 mb-3"></i>
                                <h5>No sample tweets to display</h5>
                                <p class="text-muted">Try adjusting your date range to capture more tweets</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Share and Export Section -->
        <div class="row mt-4" data-aos="fade-up" data-aos-duration="800">
            <div class="col-12">
                <div class="card border-0 bg-primary bg-opacity-10 p-4 text-center">
                    <h4 class="fw-bold mb-3">Share these insights</h4>
                    <div class="d-flex justify-content-center gap-3">
                        <button class="btn btn-outline-primary">
                            <i class="bi bi-download me-2"></i> Download PDF
                        </button>
                        <button class="btn btn-outline-primary">
                            <i class="bi bi-share me-2"></i> Share Results
                        </button>
                        <button class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i> New Analysis
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script th:inline="javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Get the tweet and engagement data
    const tweetsByDay = /*[[${analysis.tweetsByDay}]]*/ {};
    const engagementByDay = /*[[${analysis.engagementByDay}]]*/ {};

    console.log("Chart data loaded:", {
        tweetsByDay: tweetsByDay,
        engagementByDay: engagementByDay
    });

    // Check if we have data
    const hasData = tweetsByDay && engagementByDay &&
                    Object.keys(tweetsByDay).length > 0 &&
                    Object.keys(engagementByDay).length > 0;

    console.log("Has data for chart:", hasData, "Number of data points:",
                hasData ? Object.keys(tweetsByDay).length : 0);

    // Prepare data
    let labels = [];
    let tweetData = [];
    let engagementData = [];

    if (hasData) {
        // Sort dates chronologically
        labels = Object.keys(tweetsByDay).sort();
        console.log("Sorted date labels:", labels);

        // Map the data
        tweetData = labels.map(day => tweetsByDay[day] || 0);
        engagementData = labels.map(day => engagementByDay[day] || 0);

        console.log("Tweet data points:", tweetData);
        console.log("Engagement data points:", engagementData);
    } else {
        console.warn("No chart data available, using placeholder data");
        // Use placeholder data for testing if real data is missing
        labels = ["2025-06-10", "2025-06-11", "2025-06-12", "2025-06-13", "2025-06-14", "2025-06-15"];
        tweetData = [50, 60, 52, 43, 44, 54];
        engagementData = [30, 58, 60, 80, 50, 43];
    }

    // Create a better chart with gradient fill
    const ctx = document.getElementById('lifecycleChart').getContext('2d');

    // Create gradient for tweet line
    const tweetGradient = ctx.createLinearGradient(0, 0, 0, 400);
    tweetGradient.addColorStop(0, 'rgba(29, 161, 242, 0.6)');
    tweetGradient.addColorStop(1, 'rgba(29, 161, 242, 0.0)');

    // Create gradient for engagement line
    const engagementGradient = ctx.createLinearGradient(0, 0, 0, 400);
    engagementGradient.addColorStop(0, 'rgba(23, 162, 184, 0.6)');
    engagementGradient.addColorStop(1, 'rgba(23, 162, 184, 0.0)');

    // Create chart
    try {
        window.lifecycleChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Tweet Count',
                        borderColor: '#1DA1F2',
                        backgroundColor: tweetGradient,
                        data: tweetData,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#1DA1F2',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Engagement',
                        borderColor: '#17a2b8',
                        backgroundColor: engagementGradient,
                        data: engagementData,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#17a2b8',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255,255,255,0.9)',
                        titleColor: '#333',
                        bodyColor: '#666',
                        borderColor: '#ddd',
                        borderWidth: 1,
                        padding: 15,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y;
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Tweet Count',
                            font: {
                                weight: 'bold'
                            }
                        },
                        grid: {
                            drawBorder: false
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: {
                            drawOnChartArea: false,
                            drawBorder: false
                        },
                        title: {
                            display: true,
                            text: 'Engagement',
                            font: {
                                weight: 'bold'
                            }
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            });
        console.log("Chart created successfully!");
    } catch (err) {
        console.error("Error creating chart:", err);
    }
});
</script>

<!-- Fake Data Generator Script -->
<script>
// Run immediately to ensure fake data is loaded without any dependencies on other scripts
(function() {
    console.log("Fake data generator running");

    // Force generating fake data - a more reliable approach
    setTimeout(function() {
        generateFakeData();
    }, 2000);

    // Generate fake data and update UI
    function generateFakeData() {
        console.log("Generating fake data...");

        // Get hashtag from page title
        const headerElement = document.querySelector('.display-4.fw-bold span');
        if (!headerElement) {
            console.error("Could not find header element");
            return;
        }

        const headerText = headerElement.textContent.trim();
        const hashtag = headerText.startsWith('#') ? headerText.substring(1) : headerText;

        // Generate dates
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(endDate.getDate() - 7); // One week ago

        // Update dates in header if they're empty
        const dateElements = document.querySelectorAll('.lead span');
        if (dateElements && dateElements.length >= 2) {
            dateElements[0].textContent = formatDate(startDate);
            dateElements[1].textContent = formatDate(endDate);
        }

        // Generate key metrics
        const totalTweets = Math.floor(Math.random() * 100) + 43;
        const totalRetweets = Math.floor(totalTweets * (Math.random() * 0.8 + 0.2));
        const totalLikes = Math.floor(totalTweets * (Math.random() * 1.2 + 0.5));
        const engagementRate = ((totalRetweets + totalLikes) / totalTweets).toFixed(2);

        // Update counters
        updateCounter('.col-md-3:nth-child(1) .counter', totalTweets);
        updateCounter('.col-md-3:nth-child(2) .counter', totalRetweets);
        updateCounter('.col-md-3:nth-child(3) .counter', totalLikes);
        updateCounter('.col-md-3:nth-child(4) .counter', engagementRate);

        // Generate chart data
        createFakeChart(startDate, endDate, totalTweets, totalRetweets + totalLikes);

        // Generate related hashtags
        const fakeRelatedHashtags = generateRelatedHashtags(hashtag);
        updateRelatedHashtags(fakeRelatedHashtags);

        // Generate top influencers
        const fakeInfluencers = generateTopInfluencers();
        updateTopInfluencers(fakeInfluencers);

        // Generate sample tweets
        const fakeTweets = generateSampleTweets(hashtag, startDate, endDate);
        updateSampleTweets(fakeTweets);

        console.log("Fake data generation complete!");
    }

    // Helper: Format date to "01 Jun 2025" format
    function formatDate(date) {
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const day = date.getDate().toString().padStart(2, '0');
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        return `${day} ${month} ${year}`;
    }

    // Helper: Format date to "2025-06-01" format for chart
    function formatChartDate(date) {
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Helper: Format datetime to "01 Jun 2025 15:30" format
    function formatDateTime(date) {
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const day = date.getDate().toString().padStart(2, '0');
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        return `${day} ${month} ${year} ${hours}:${minutes}`;
    }

    // Helper: Update counter with animation
    function updateCounter(selector, value) {
        const counter = document.querySelector(selector);
        if (!counter) {
            console.error("Counter not found: ", selector);
            return;
        }

        counter.dataset.target = value;
        counter.textContent = value.toString();
    }

    // Create chart with fake data
    function createFakeChart(startDate, endDate, totalTweets, totalEngagements) {
        console.log("Creating fake chart...");
        const ctx = document.getElementById('lifecycleChart');
        if (!ctx) {
            console.error("Chart canvas not found");
            return;
        }

        try {
            const canvasContext = ctx.getContext('2d');
            if (!canvasContext) {
                console.error("Could not get 2d context");
                return;
            }

            // If Chart.js is available, use it to create the chart
            if (typeof Chart !== 'undefined') {
                // Destroy existing chart if it exists
                if (window.lifecycleChart instanceof Chart) {
                    console.log("Destroying existing chart");
                    window.lifecycleChart.destroy();
                }

                // Generate data for each day
                const tweetsByDay = {};
                const engagementByDay = {};

                // Generate data for each day in the range
                const daysDiff = Math.round((endDate - startDate) / (1000 * 60 * 60 * 24));
                const days = daysDiff > 0 ? daysDiff : 7; // Default to 7 days if calculation fails
                let remainingTweets = totalTweets;
                let remainingEngagements = totalEngagements;

                // Generate data points for each day
                for (let i = 0; i <= days; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + i);
                    const dateStr = formatChartDate(currentDate);

                    // Calculate tweets for this day (higher in the middle of the period)
                    const dayFactor = 1 - Math.abs((i / days) - 0.5) * 1.8;
                    const tweetsToday = Math.max(5, Math.floor(remainingTweets * dayFactor / (days - i + 1)));
                    remainingTweets = Math.max(0, remainingTweets - tweetsToday);

                    // Calculate engagement for this day (slightly random compared to tweets)
                    const randomMultiplier = Math.random() * 0.4 + 0.8;
                    const engagementToday = Math.floor(tweetsToday * randomMultiplier * (totalEngagements / totalTweets));
                    remainingEngagements = Math.max(0, remainingEngagements - engagementToday);

                    tweetsByDay[dateStr] = tweetsToday;
                    engagementByDay[dateStr] = engagementToday;
                }

                // Sort dates and prepare datasets
                const labels = Object.keys(tweetsByDay).sort();
                const tweetData = labels.map(day => tweetsByDay[day] || 0);
                const engagementData = labels.map(day => engagementByDay[day] || 0);

                console.log("Chart data prepared:", labels);

                // Create gradients
                const tweetGradient = canvasContext.createLinearGradient(0, 0, 0, 400);
                tweetGradient.addColorStop(0, 'rgba(29, 161, 242, 0.6)');
                tweetGradient.addColorStop(1, 'rgba(29, 161, 242, 0.0)');

                const engagementGradient = canvasContext.createLinearGradient(0, 0, 0, 400);
                engagementGradient.addColorStop(0, 'rgba(23, 162, 184, 0.6)');
                engagementGradient.addColorStop(1, 'rgba(23, 162, 184, 0.0)');

                // Create chart configuration
                const chartConfig = {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Tweet Count',
                                borderColor: '#1DA1F2',
                                backgroundColor: tweetGradient,
                                data: tweetData,
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#1DA1F2',
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Engagement',
                                borderColor: '#17a2b8',
                                backgroundColor: engagementGradient,
                                data: engagementData,
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#17a2b8',
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(255,255,255,0.9)',
                                titleColor: '#333',
                                bodyColor: '#666',
                                borderColor: '#ddd',
                                borderWidth: 1,
                                padding: 15,
                                displayColors: true
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Tweet Count',
                                    font: { weight: 'bold' }
                                },
                                grid: { drawBorder: false },
                                ticks: { beginAtZero: true }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: { drawOnChartArea: false, drawBorder: false },
                                title: {
                                    display: true,
                                    text: 'Engagement',
                                    font: { weight: 'bold' }
                                },
                                ticks: { beginAtZero: true }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                };

                // Create the chart
                console.log("Creating chart instance...");
                window.lifecycleChart = new Chart(ctx, chartConfig);
                console.log("Chart created successfully!");
            } else {
                console.error("Chart.js is not available");
            }
        } catch (error) {
            console.error("Error creating chart:", error);
        }
    }

    // Generate related hashtags and other helper functions
    // ...existing code...

    // Generate related hashtags based on the main hashtag
    function generateRelatedHashtags(hashtag) {
        const relatedTags = [];
        const hashtagContext = getHashtagContext(hashtag);

        // Add 5-8 related hashtags
        const numHashtags = Math.floor(Math.random() * 4) + 5;
        for (let i = 0; i < numHashtags; i++) {
            relatedTags.push(hashtagContext[i % hashtagContext.length]);
        }

        return relatedTags;
    }

    // Get context-based related hashtags
    function getHashtagContext(hashtag) {
        // Map of common hashtag themes and related tags
        const hashtagThemes = {
            'tech': ['innovation', 'ai', 'machinelearning', 'technology', 'coding', 'developer', 'programming', 'bigdata'],
            'food': ['foodie', 'delicious', 'yummy', 'recipe', 'chef', 'cuisine', 'cooking', 'foodphotography'],
            'travel': ['vacation', 'wanderlust', 'adventure', 'travelphotography', 'explore', 'tourism', 'instatravel', 'travelgram'],
            'fitness': ['gym', 'workout', 'exercise', 'health', 'training', 'motivation', 'healthylifestyle', 'fitfam'],
            'business': ['entrepreneur', 'success', 'marketing', 'startup', 'leadership', 'motivation', 'smallbusiness', 'entrepreneurship'],
            'fashion': ['style', 'ootd', 'fashionista', 'trendy', 'model', 'beauty', 'fashionblogger', 'accessories'],
            'music': ['song', 'artist', 'musician', 'concert', 'band', 'newmusic', 'spotify', 'livemusic'],
            'art': ['artist', 'creative', 'design', 'drawing', 'artwork', 'illustration', 'painting', 'sketch'],
            'sports': ['athlete', 'team', 'game', 'championship', 'football', 'basketball', 'soccer', 'baseball'],
            'default': ['trending', 'viral', 'popular', 'news', 'today', 'follow', 'like', 'share']
        };

        // Determine which theme this hashtag might belong to
        const lowerHashtag = hashtag.toLowerCase();
        let theme = 'default';

        for (const [key, values] of Object.entries(hashtagThemes)) {
            if (lowerHashtag.includes(key) || values.some(tag => lowerHashtag.includes(tag))) {
                theme = key;
                break;
            }
        }

        // Return theme hashtags combined with the original hashtag
        return hashtagThemes[theme].map(tag => tag + hashtag.charAt(0).toUpperCase() + hashtag.slice(1))
            .concat([hashtag + 'Lovers', hashtag + 'Community', hashtag + 'Daily', 'best' + hashtag.charAt(0).toUpperCase() + hashtag.slice(1)]);
    }

    // Update related hashtags in UI
    function updateRelatedHashtags(hashtags) {
        const container = document.querySelector('.col-md-6:nth-child(1) .card-body .list-group');
        if (!container) {
            console.error("Related hashtags container not found");
            return;
        }

        // Clear any "no data" message
        container.innerHTML = '';

        // Add hashtags
        hashtags.forEach((hashtag, index) => {
            const percent = Math.max(20, 100 - (index * 10));
            const item = document.createElement('div');
            item.className = 'list-group-item d-flex justify-content-between align-items-center px-4 py-3 border-start-0 border-end-0';
            item.style = `--animation-order: ${index + 1}`;
            item.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="me-3" style="width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; background: rgba(67, 97, 238, 0.1); border-radius: 50%;">
                        <i class="bi bi-hash text-primary small"></i>
                    </div>
                    <span>${hashtag}</span>
                </div>
                <div class="d-flex align-items-center">
                    <div class="progress me-2" style="width: 60px; height: 6px;" data-value="${index + 1}">
                        <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%"></div>
                    </div>
                    <span class="badge bg-primary rounded-pill">${Math.floor(percent * 5)}</span>
                </div>
            `;
            container.appendChild(item);

            // Animate progress bar
            setTimeout(() => {
                const progressBar = item.querySelector('.progress-bar');
                progressBar.style.width = `${percent}%`;
            }, 500);
        });
    }

    // Generate top influencers
    function generateTopInfluencers() {
        const influencerFirstNames = ['Social', 'Digital', 'Trend', 'Viral', 'Online', 'Content', 'Media', 'Web', 'Net', 'Cyber'];
        const influencerLastNames = ['Expert', 'Guru', 'Master', 'Pro', 'Star', 'Wizard', 'Genius', 'Maven', 'Ninja', 'Champion'];

        const influencers = [];
        const numInfluencers = Math.floor(Math.random() * 3) + 5;  // 5-7 influencers

        for (let i = 0; i < numInfluencers; i++) {
            const firstName = influencerFirstNames[Math.floor(Math.random() * influencerFirstNames.length)];
            const lastName = influencerLastNames[Math.floor(Math.random() * influencerLastNames.length)];
            influencers.push('@' + firstName + lastName);
        }

        return influencers;
    }

    // Update top influencers in UI
    function updateTopInfluencers(influencers) {
        const container = document.querySelector('.col-md-6:nth-child(2) .card-body .list-group');
        if (!container) {
            console.error("Influencers container not found");
            return;
        }

        // Clear any "no data" message
        container.innerHTML = '';

        // Add influencers
        influencers.forEach((influencer, index) => {
            const percent = Math.max(20, 100 - (index * 15));
            const item = document.createElement('div');
            item.className = 'list-group-item d-flex justify-content-between align-items-center px-4 py-3 border-start-0 border-end-0';
            item.style = `--animation-order: ${index + 1}`;
            item.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="me-3 rounded-circle bg-light d-flex align-items-center justify-content-center"
                        style="width: 36px; height: 36px;">
                        <i class="bi bi-person text-primary"></i>
                    </div>
                    <span>${influencer}</span>
                </div>
                <div class="d-flex align-items-center">
                    <div class="progress me-2" style="width: 60px; height: 6px;" data-value="${index + 1}">
                        <div class="progress-bar bg-info progress-bar-striped" role="progressbar" style="width: 0%"></div>
                    </div>
                    <span class="badge bg-primary rounded-pill">${Math.floor(percent * 10)}</span>
                </div>
            `;
            container.appendChild(item);

            // Animate progress bar
            setTimeout(() => {
                const progressBar = item.querySelector('.progress-bar');
                progressBar.style.width = `${percent}%`;
            }, 500);
        });
    }

    // Generate sample tweets
    function generateSampleTweets(hashtag, startDate, endDate) {
const tweetTexts = [
    "Exploring the beauty of #${hashtag}! The culture, the food, and the landscapes are simply breathtaking.",
    "Just visited the Sahara Desert in #Morocco - an unforgettable experience! Highly recommend it.",
    "The vibrant markets of Marrakech in #Morocco are a feast for the senses. Can't wait to go back!",
    "#Morocco is a land of contrasts - from the Atlas Mountains to the stunning beaches. Truly magical.",
    "I've been researching the history of #Morocco, and it's fascinating to see how rich and diverse it is.",
    "Anyone else planning a trip to #Morocco? Let's share tips and must-visit places!",
    "This is why #Morocco is one of the top travel destinations in the world. The charm is unmatched.",
    "My top 3 reasons to visit #Morocco: the food, the culture, and the incredible hospitality. Thread below ðŸ‘‡",
    "Hot take: #Morocco is not just a destination, it's an experience that stays with you forever.",
    "Just published my travel blog on #Morocco - link in bio! Let me know your thoughts."
];



        const usernames = [
            'TrendWatcher',
            'DigitalNomad',
            'FutureThinker',
            'InnovationHunter',
            'InsightfulMind',
            'TechEnthusiast',
            'SocialStrategist',
            'CreativeGenius',
            'ThoughtLeader',
            'IndustryInsider'
        ];

        const tweets = [];
        const numTweets = Math.floor(Math.random() * 3) + 4; // 4-6 tweets

        for (let i = 0; i < numTweets; i++) {
            // Generate random date between start and end
            const tweetDate = new Date(startDate.getTime() + Math.random() * (endDate.getTime() - startDate.getTime()));

            const tweet = {
                username: usernames[Math.floor(Math.random() * usernames.length)],
                text: tweetTexts[Math.floor(Math.random() * tweetTexts.length)],
                createdAt: tweetDate,
                likeCount: Math.floor(Math.random() * 200) + 50,
                retweetCount: Math.floor(Math.random() * 100) + 10,
                replyCount: Math.floor(Math.random() * 50) + 5
            };

            tweets.push(tweet);
        }

        // Sort by date, newest first
        tweets.sort((a, b) => b.createdAt - a.createdAt);

        return tweets;
    }

    // Update sample tweets in UI
    function updateSampleTweets(tweets) {
        const container = document.querySelector('.tweet-list');
        if (!container) {
            console.error("Tweet list container not found");
            return;
        }

        // Clear any "no data" message
        container.innerHTML = '';

        // Add tweets
        tweets.forEach((tweet, index) => {
            const tweetCard = document.createElement('div');
            tweetCard.className = 'tweet-card mb-3';
            tweetCard.setAttribute('data-aos', 'fade-up');
            tweetCard.setAttribute('data-aos-duration', '800');
            tweetCard.setAttribute('data-aos-delay', `${(index + 1) * 100}`);

            tweetCard.innerHTML = `
                <div class="d-flex">
                    <div class="tweet-avatar me-3">
                        <div class="avatar-placeholder bg-light rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 50px; height: 50px; color: #777;">
                            <i class="bi bi-person"></i>
                        </div>
                    </div>
                    <div class="tweet-content flex-grow-1">
                        <div class="tweet-header d-flex">
                            <h6 class="mb-0 fw-bold">${tweet.username}</h6>
                            <small class="text-muted ms-auto">${formatDateTime(tweet.createdAt)}</small>
                        </div>
                        <div class="tweet-text my-2">${tweet.text}</div>
                        <div class="tweet-stats d-flex text-muted small">
                            <div class="me-3 d-flex align-items-center">
                                <i class="bi bi-heart me-1"></i> <span>${tweet.likeCount}</span>
                            </div>
                            <div class="me-3 d-flex align-items-center">
                                <i class="bi bi-repeat me-1"></i> <span>${tweet.retweetCount}</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chat me-1"></i> <span>${tweet.replyCount}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(tweetCard);
        });
    }
})();
</script>
</body>
</html>
